# v3.0 游戏化系统更新说明

## 📋 更新概述

v3.0版本引入了完整的游戏化系统，让任务管理更有趣、更有动力！

## 🎮 核心功能

### 1. 等级系统（LV1-20）
- **升级机制**：通过完成任务获得经验值（EXP），累积经验值可以升级
- **升级速度**：适中，预计2-3个月达到LV13（解锁高级商店）
- **等级解锁**：
  - LV1-3：四象限报告（已加强）
  - LV4-7：每日成就盲盒卡片 + 解锁专业型性格
  - LV8-12：周报多维数据透视 + 解锁严格型性格
  - LV13+：高级商店 + 解锁毒舌型性格

### 2. 经验值系统
- **计算规则**：完成任务进度 × 象限权重
- **象限权重**：
  - Q1（重要且紧急）：2.0x
  - Q2（重要非紧急）：1.5x
  - Q3（紧急非重要）：1.0x
  - Q4（非紧急非重要）：0.5x
- **示例**：完成Q1任务50%进度 = 50 × 2.0 = 100 EXP

### 3. 金币系统
- **初始金币**：200 Coin
- **获得方式**：根据每日任务完成率自动结算
  - 完成率100%：+100 Coin
  - 完成率80-99%：+50 Coin
  - 完成率60-79%：+20 Coin
  - 完成率<60%：+5 Coin（保底）
- **用途**：购买商店道具（LV13+解锁）

### 4. AI性格系统
- **可选性格**：
  - 🌟 友好型（LV1+）：温暖鼓励，适合新手
  - 💼 专业型（LV4+）：理性分析，给出建议
  - 🔥 严格型（LV8+）：督导为主，要求高
  - 💀 毒舌型（LV13+）：犀利吐槽，激励效果强
- **切换方式**：在回复邮件时输入"切换性格：专业型"

### 5. 连击系统
- **Q1连击**：连续完成Q1任务可获得连击奖励
- **连击奖励**：连续3天完成Q1任务，奖励翻倍

### 6. 商店系统（LV13+解锁）
包含18种道具，分为4个等级：
- **基础道具**（LV13+）：拖延对冲券、象限置换权等
- **激励道具**（LV13+）：AI夸夸盲盒、数字遗产备份等
- **高级道具**（LV16+）：月度勋章卡片、专属称号等
- **特殊道具**（LV20）：时光回溯、终极成就等

## 📊 用户界面变化

### 每日复盘邮件新增内容
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 四象限说明：
  Q1 🔴 重要且紧急   - 必须立即处理（EXP x2.0）
  Q2 🟡 重要非紧急   - 计划安排处理（EXP x1.5）
  Q3 🔵 紧急非重要   - 可委托他人（EXP x1.0）
  Q4 ⚪ 非紧急非重要 - 有空再处理（EXP x0.5）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 你的状态：
  ⭐ 等级：LV1 (EXP: 0/100)
     [□□□□□□□□□□] 0%
  💰 金币：200 Coin
  🔥 连击：0天
  🎭 性格：🌟 友好型
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 提示：你可以在回复中切换AI性格
格式：切换性格：专业型
```

### 任务更新反馈新增内容
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📈 本次收获：
   💫 经验值：+100 EXP
   💰 金币：+50 Coin
   📊 完成率：80% (4/5)
   🔥 Q1连击：3天
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

╔═══════════════════════════════════╗
║  ⬆️ 等级提升：LV3 → LV4           ║
╠═══════════════════════════════════╣
║                                   ║
║  🎊 恭喜升级！                    ║
║     🎁 解锁：每日成就盲盒卡片    ║
║     🎭 解锁：专业型性格          ║
║                                   ║
╚═══════════════════════════════════╝
```

## 🚀 部署步骤

### 1. 更新数据库
在Supabase SQL编辑器中执行 `database_update_v3.0.sql`：

```sql
-- 创建5个新表：
-- 1. user_gamification（用户游戏化数据）
-- 2. level_config（等级配置）
-- 3. shop_items（商店道具）
-- 4. user_inventory（用户背包）
-- 5. exp_history（经验值历史）
```

### 2. 更新代码文件
确保以下文件已更新到最新版本：
- `scripts/gamification_utils.py`（新增）
- `scripts/check_email_reply.py`（已修改）
- `scripts/daily_review.py`（已修改）

### 3. 推送到GitHub
```bash
git add .
git commit -m "v3.0: 添加游戏化系统"
git push origin main
```

### 4. 验证部署
- 等待GitHub Actions自动运行
- 检查每日复盘邮件是否显示新的游戏化界面
- 回复邮件测试经验值和金币是否正常累积

## 📝 用户交互格式

### 回复邮件格式（保持不变）
```
完成了用户登录功能80% Q1
数据库设计50% Q2
暂缓：前端优化
```

### 切换AI性格
```
切换性格：专业型
```

### 购买商店道具（LV13+）
```
购买：拖延对冲券
```

## ⚠️ 注意事项

1. **数据库更新**：必须先执行 `database_update_v3.0.sql` 才能使用游戏化功能
2. **初始状态**：所有用户初始为LV1，0 EXP，200 Coin
3. **向后兼容**：如果数据库中没有游戏化数据，系统会自动创建
4. **性格切换**：只能切换到当前等级已解锁的性格
5. **商店功能**：LV13以下无法使用商店，需要先升级

## 🔮 未来计划

### 阶段2：AI性格系统完善（待实现）
- 实现性格切换命令识别
- 根据选择的性格调整AI反馈风格

### 阶段3：商店系统实现（待实现）
- 实现购买命令识别
- 实现道具效果逻辑
- 实现背包管理

### 阶段4：连击和成就卡片（待实现）
- 实现连击奖励翻倍
- 实现每日成就盲盒卡片生成

### 阶段5：高级功能（待实现）
- 周报多维数据透视
- 月度勋章卡片生成
- 高级商店道具效果

## 📞 问题反馈

如遇到问题，请检查：
1. 数据库是否正确执行了 `database_update_v3.0.sql`
2. GitHub Secrets 是否配置完整
3. GitHub Actions 工作流是否正常运行
4. 查看 Actions 日志中的错误信息

---

**版本**：v3.0  
**更新日期**：2026-02-10  
**状态**：阶段1（核心系统）已完成
