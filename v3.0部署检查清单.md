# v3.0 部署检查清单

## 📋 部署前准备

- [ ] 确认已经阅读 `v3.0数据库部署指南.md`
- [ ] 确认 Supabase 账号可以正常登录
- [ ] 确认项目文件夹中有 `database_update_v3.0.sql` 文件

## 🗄️ 数据库部署（第一步）

### 操作步骤
1. [ ] 登录 Supabase (https://supabase.com)
2. [ ] 进入 ai-email-coach 项目
3. [ ] 点击左侧 **SQL Editor**
4. [ ] 打开本地的 `database_update_v3.0.sql` 文件
5. [ ] 复制所有内容（Ctrl+A → Ctrl+C）
6. [ ] 粘贴到 SQL 编辑器（Ctrl+V）
7. [ ] 点击 **Run** 按钮执行
8. [ ] 等待执行完成，看到 ✅ Success 提示

### 验证步骤
9. [ ] 点击左侧 **Table Editor**
10. [ ] 确认看到 5 个新表：
    - [ ] `user_gamification`
    - [ ] `level_config`
    - [ ] `shop_items`
    - [ ] `user_inventory`
    - [ ] `exp_history`
11. [ ] 点击 `level_config` 表，确认有 20 条数据
12. [ ] 点击 `shop_items` 表，确认有 16 条数据

**✅ 数据库部署完成！**

---

## 💻 代码部署（第二步）

### 推送到 GitHub

1. [ ] 打开命令行/终端，进入项目文件夹
2. [ ] 执行以下命令：

```bash
# 查看修改的文件
git status

# 添加所有修改
git add .

# 提交修改
git commit -m "v3.0: 添加游戏化系统（等级、经验值、金币）"

# 推送到 GitHub
git push origin main
```

### 验证 GitHub Actions

3. [ ] 打开浏览器，访问你的 GitHub 仓库
4. [ ] 点击顶部的 **Actions** 标签
5. [ ] 查看是否有新的工作流正在运行
6. [ ] 等待所有工作流完成（绿色 ✅）

**✅ 代码部署完成！**

---

## 🧪 功能测试（第三步）

### 测试1：查看每日复盘邮件

- [ ] 等待今晚 22:00（北京时间）
- [ ] 检查邮箱/飞书，查看是否收到每日复盘邮件
- [ ] 确认邮件中包含以下新内容：
  - [ ] 四象限说明（带 EXP 权重）
  - [ ] 你的状态（等级、经验值、金币、连击、性格）
  - [ ] 性格切换提示

**预期效果示例：**
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 四象限说明：
  Q1 🔴 重要且紧急   - 必须立即处理（EXP x2.0）
  Q2 🟡 重要非紧急   - 计划安排处理（EXP x1.5）
  Q3 🔵 紧急非重要   - 可委托他人（EXP x1.0）
  Q4 ⚪ 非紧急非重要 - 有空再处理（EXP x0.5）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 你的状态：
  ⭐ 等级：LV1 (EXP: 0/100)
     [□□□□□□□□□□] 0%
  💰 金币：200 Coin
  🔥 连击：0天
  🎭 性格：🌟 友好型
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 测试2：回复邮件更新任务

- [ ] 回复邮件，更新任务进度
- [ ] 示例回复内容：
  ```
  完成了测试任务50% Q1
  新任务30% Q2
  ```
- [ ] 等待 23:30 自动处理
- [ ] 检查反馈邮件/飞书消息

**预期效果示例：**
```
📊 任务更新反馈

🔄 测试任务
   进度：[■■■■■□□□□□] 50%
   象限: Q1
   💫 +100 EXP

🆕 新任务
   进度：[■■■□□□□□□□] 30%
   象限: Q2
   💫 +45 EXP

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📈 本次收获：
   💫 经验值：+145 EXP
   💰 金币：+50 Coin
   📊 完成率：50% (1/2)
   🔥 Q1连击：0天
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 测试3：验证经验值计算

- [ ] 创建不同象限的任务，验证 EXP 权重：
  - [ ] Q1 任务 50% → 应获得 100 EXP (50 × 2.0)
  - [ ] Q2 任务 50% → 应获得 75 EXP (50 × 1.5)
  - [ ] Q3 任务 50% → 应获得 50 EXP (50 × 1.0)
  - [ ] Q4 任务 50% → 应获得 25 EXP (50 × 0.5)

### 测试4：验证升级功能

- [ ] 累积 100 EXP 后，查看是否升级到 LV2
- [ ] 确认升级消息是否显示
- [ ] 确认当前经验值是否正确重置

**预期升级消息：**
```
╔═══════════════════════════════════╗
║  ⬆️ 等级提升：LV1 → LV2           ║
╠═══════════════════════════════════╣
║                                   ║
║  🎊 恭喜升级！                    ║
║                                   ║
╚═══════════════════════════════════╝
```

### 测试5：验证金币结算

- [ ] 完成率 100% → 应获得 100 Coin
- [ ] 完成率 80-99% → 应获得 50 Coin
- [ ] 完成率 60-79% → 应获得 20 Coin
- [ ] 完成率 <60% → 应获得 5 Coin

**✅ 功能测试完成！**

---

## 🐛 问题排查

如果遇到问题，按以下顺序检查：

### 问题1：没有收到邮件
- [ ] 检查 GitHub Actions 是否正常运行
- [ ] 检查 Actions 日志中是否有错误
- [ ] 检查 GitHub Secrets 是否配置完整
- [ ] 检查邮箱垃圾箱

### 问题2：邮件中没有游戏化内容
- [ ] 确认数据库已正确部署（5个表都存在）
- [ ] 确认代码已推送到 GitHub
- [ ] 查看 Actions 日志，搜索 "游戏化" 或 "gamification"
- [ ] 检查是否有 Python 错误

### 问题3：经验值计算不正确
- [ ] 检查任务的象限是否正确（Q1/Q2/Q3/Q4）
- [ ] 检查进度变化是否正确
- [ ] 查看 Actions 日志中的 "更新游戏化数据" 信息
- [ ] 在 Supabase 中查看 `exp_history` 表的记录

### 问题4：升级不生效
- [ ] 在 Supabase 中查看 `user_gamification` 表
- [ ] 确认 `current_exp` 和 `level` 字段的值
- [ ] 确认 `level_config` 表中的升级经验值配置
- [ ] 查看 Actions 日志中是否有升级相关的输出

---

## 📊 数据查看

### 在 Supabase 中查看用户数据

1. [ ] 登录 Supabase
2. [ ] 点击 **Table Editor**
3. [ ] 点击 `user_gamification` 表
4. [ ] 查看你的用户数据：
   - `level`: 当前等级
   - `current_exp`: 当前经验值
   - `total_exp`: 总经验值
   - `coins`: 金币数量
   - `consecutive_q1_days`: Q1连击天数
   - `ai_personality`: AI性格

### 查看经验值历史

1. [ ] 点击 `exp_history` 表
2. [ ] 查看每次获得经验值的记录
3. [ ] 确认 `exp_gained` 和 `coins_gained` 是否正确

---

## ✅ 部署完成确认

当以下所有项都打勾时，说明 v3.0 部署成功：

- [ ] 数据库 5 个表都创建成功
- [ ] 代码推送到 GitHub 成功
- [ ] GitHub Actions 运行成功
- [ ] 收到带游戏化内容的每日复盘邮件
- [ ] 回复邮件后收到带 EXP/金币的反馈
- [ ] 经验值和金币计算正确
- [ ] 升级功能正常工作

**🎉 恭喜！v3.0 游戏化系统部署成功！**

---

## 📝 备注

- 初始状态：LV1, 0 EXP, 200 Coin
- 升级到 LV2 需要：100 EXP
- 升级到 LV4（解锁专业型性格）需要：累计 1000 EXP
- 升级到 LV13（解锁商店）需要：累计 9100 EXP

预计时间：
- 每天完成 2-3 个 Q1 任务（50%进度）→ 约 200-300 EXP/天
- 达到 LV4 需要：约 3-5 天
- 达到 LV13 需要：约 30-45 天（1-1.5个月）

---

**最后更新**：2026-02-10  
**版本**：v3.0
