# AI邮件督导系统 - 使用说明

## ✅ 当前状态

- ✅ POP3连接测试成功
- ✅ 163邮箱配置正常（47封邮件）
- ✅ 通知系统测试成功（163 SMTP + 飞书）
- ✅ 数据库配置完成
- ✅ LLM配置完成（DeepSeek）

## 🚀 快速启动

### 方式1：使用批处理文件（推荐）

双击运行：
```
run_email_coach.bat
```

### 方式2：命令行启动

```bash
# 激活虚拟环境
ai-email-coach-env\Scripts\activate.bat

# 运行邮件督导
python simple_email_coach_pop3.py
```

## 📧 系统工作流程

1. **接收邮件**
   - 系统每60秒（可自定义）检查一次163邮箱
   - 使用POP3协议获取最新邮件
   - 自动识别未处理的邮件

2. **AI解析**
   - 使用DeepSeek LLM解析邮件内容
   - 提取任务名称、进度百分比、象限信息
   - 识别用户意图（新增任务/更新进度/修改计划）

3. **数据库更新**
   - 将解析结果同步到Supabase数据库
   - 更新任务状态和进度
   - 记录操作历史

4. **发送反馈**
   - 生成个性化反馈邮件（根据用户persona）
   - 包含ASCII进度条
   - 显示四象限任务清单
   - 通过163 SMTP和飞书同时发送

## 📝 如何使用

### 发送任务更新邮件

给 `15302814198@163.com` 发送邮件，内容示例：

```
今天完成了用户登录功能，进度80%，这是Q1任务
数据库设计进度50%，Q2任务
```

### AI会自动识别

- 任务名称：用户登录功能、数据库设计
- 进度：80%、50%
- 象限：Q1（重要紧急）、Q2（重要不紧急）

### 收到反馈

系统会自动回复邮件，包含：
- 任务进度条 [■■■■□]
- 四象限任务清单
- 个性化建议（根据你的persona设置）

## ⚙️ 配置说明

### 当前配置（.env文件）

```env
# 数据库
SUPABASE_URL=https://cnmxhxapwksjczfxugtx.supabase.co
SUPABASE_KEY=eyJhbGc...（已配置）

# LLM
DEEPSEEK_API_KEY=sk-86436...（已配置）

# 邮箱
EMAIL_163_USERNAME=15302814198@163.com
EMAIL_163_PASSWORD=JSewF34VrE5GGNwQ（授权码）

# 飞书
FEISHU_WEBHOOK_URL=https://open.feishu.cn/...（已配置）
```

### 修改检查间隔

启动时会提示输入检查间隔（秒），默认60秒：
```
请输入邮件检查间隔（秒，默认60秒，直接回车使用默认值）: 30
```

### 修改Persona（个性）

在Supabase的 `user_configs` 表中修改 `persona` 字段：
- `toxic`: 毒舌模式（犀利、反讽）
- `warm`: 暖心模式（温柔、鼓励）
- `neutral`: 中性模式（客观、专业）

## 🔧 故障排除

### IMAP vs POP3

- ❌ IMAP：163邮箱有"Unsafe Login"限制，SELECT命令被阻止
- ✅ POP3：工作正常，推荐使用

### 如果邮件接收失败

1. 检查163邮箱是否开启POP3服务
2. 确认使用的是授权码，不是登录密码
3. 查看 `.env` 文件中的配置是否正确

### 如果邮件发送失败

1. 检查163 SMTP配置
2. 确认授权码权限
3. 查看飞书webhook是否正常

## 📊 测试脚本

### 测试POP3连接
```bash
python test_pop3.py
```

### 测试通知发送
```bash
python test_notifications.py
```

### 测试完整流程
```bash
python real_email_test.py
```

## 🎯 下一步

1. **启动系统**
   ```bash
   run_email_coach.bat
   ```

2. **发送测试邮件**
   - 给 15302814198@163.com 发送任务更新
   - 等待系统处理（最多60秒）

3. **查看反馈**
   - 检查你的邮箱
   - 查看飞书群消息

4. **调整配置**
   - 根据需要修改检查间隔
   - 在Supabase中设置persona

## 💡 提示

- 系统会记住已处理的邮件，不会重复处理
- 按 Ctrl+C 可以随时停止系统
- 建议在后台运行，保持系统持续监听
- 可以配置多个通知渠道（邮件、飞书、企业微信等）

## 📞 技术支持

如遇问题，请查看：
- `163邮箱IMAP配置指南.md` - 邮箱配置详细说明
- `.kiro/specs/ai-email-coach/` - 完整的系统设计文档
