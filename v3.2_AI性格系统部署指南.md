# v3.2 AI性格系统部署指南

## 📋 更新内容

v3.2 版本实现了完整的AI性格系统：

### 🎭 核心功能
1. **4种AI性格**：友好型、专业型、严格型、毒舌型
2. **性格切换命令**：识别"切换性格：XXX型"命令
3. **等级解锁**：不同性格需要不同等级才能解锁
4. **个性化反馈**：根据选择的性格生成不同风格的反馈
5. **切换提示**：切换成功后显示确认消息

### 🎨 4种AI性格详解

#### 1. 🌟 友好型（LV1+）
- **特点**：温暖鼓励，像朋友一样
- **适合**：新手，需要鼓励和支持
- **风格**：多用赞美和鼓励的话，即使进度慢也给予理解
- **示例**：
  ```
  看到你完成了50%的进度，真的很棒！虽然还有一些任务在进行中，
  但你已经在稳步前进了。继续保持这个节奏，相信你一定能完成所有任务。
  记得合理安排时间，不要给自己太大压力哦。
  ```

#### 2. 💼 专业型（LV4+）
- **特点**：理性分析，给出建议
- **适合**：需要客观分析和专业建议
- **风格**：基于数据分析，指出问题并提供解决方案
- **示例**：
  ```
  根据数据分析，你本周完成了2个任务，完成率50%。建议优先处理Q1任务，
  因为这些任务对整体进度影响最大。Q2任务可以合理安排到下周。
  从时间管理角度看，建议将大任务拆分成小任务，这样更容易跟踪进度。
  ```

#### 3. 🔥 严格型（LV8+）
- **特点**：督导为主，要求高
- **适合**：需要压力和督促
- **风格**：直接指出问题，设定高标准
- **示例**：
  ```
  50%的完成率还不够！你有能力做得更好。Q1任务必须优先完成，
  不能再拖延了。明天必须把进度提升到至少70%，否则会影响整体计划。
  时间不等人，现在就行动起来！
  ```

#### 4. 💀 毒舌型（LV13+）
- **特点**：犀利吐槽，激将法
- **适合**：需要强烈刺激和激励
- **风格**：用反讽和幽默激发动力
- **示例**：
  ```
  哟，50%的进度？这就是你说的"努力"？我见过蜗牛爬得都比你快。
  Q1任务还在那躺着呢，是在等它自己完成吗？别找借口了，
  要么现在就去做，要么就承认自己就是个拖延症晚期患者。
  反正我是不信你能完成的，除非你证明给我看。
  ```

---

## 🚀 部署步骤

### 第一步：无需数据库更新

v3.2 不需要数据库更新，因为：
- `user_gamification` 表已经有 `ai_personality` 字段（v3.0创建）
- 所有性格数据已经在 `level_config` 表中（v3.0创建）

**✅ 跳过数据库更新步骤！**

---

### 第二步：推送代码到 GitHub

```bash
# 查看修改的文件
git status

# 添加所有修改
git add .

# 提交修改
git commit -m "v3.2: 实现AI性格系统"

# 推送到 GitHub
git push origin main
```

### 验证 GitHub Actions

1. 打开浏览器，访问你的 GitHub 仓库
2. 点击顶部的 **Actions** 标签
3. 查看是否有新的工作流正在运行
4. 等待所有工作流完成（绿色 ✅）

**✅ 代码部署完成！**

---

## 🧪 功能测试

### 测试1：查看可用性格

**测试场景**：查看每日复盘邮件中的性格提示

1. [ ] 等待今晚22:00收到每日复盘邮件
2. [ ] 查看邮件末尾的性格切换提示
3. [ ] 预期结果（根据等级不同）：
   ```
   LV1-3：
   💡 提示：你可以在回复中切换AI性格
   格式：切换性格：专业型
   
   LV4-7：
   💡 提示：你可以在回复中切换AI性格
   格式：切换性格：专业型
   
   LV8-12：
   💡 提示：你可以在回复中切换AI性格
   格式：切换性格：专业型 / 严格型
   
   LV13+：
   💡 提示：你可以在回复中切换AI性格
   格式：切换性格：专业型 / 严格型 / 毒舌型
   ```

### 测试2：切换到专业型（LV4+）

**测试场景**：切换到专业型性格

1. [ ] 回复邮件，内容包含：
   ```
   完成了测试任务50% Q1
   切换性格：专业型
   ```
2. [ ] 等待23:30收到反馈
3. [ ] 预期结果：
   ```
   ╔═══════════════════════════════════╗
   ║  🎭 性格切换成功                  ║
   ╠═══════════════════════════════════╣
   ║                                   ║
   ║  🌟 友好型 → 💼 专业型            ║
   ║                                   ║
   ║  从现在开始，我会用新的风格      ║
   ║  与你交流！                       ║
   ║                                   ║
   ╚═══════════════════════════════════╝
   ```
4. [ ] AI反馈应该是专业、理性的风格

### 测试3：等级不足切换失败

**测试场景**：LV1尝试切换到严格型（需要LV8）

1. [ ] 确认当前等级 < LV8
2. [ ] 回复邮件：`切换性格：严格型`
3. [ ] 预期结果：
   ```
   ⚠️ 性格切换失败
   
   🔥 严格型 需要 LV8 才能解锁
   你当前等级：LV1
   
   💡 继续升级即可解锁更多性格！
   ```

### 测试4：重复切换

**测试场景**：切换到已经是的性格

1. [ ] 当前性格是友好型
2. [ ] 回复邮件：`切换性格：友好型`
3. [ ] 预期结果：
   ```
   💡 你已经是 🌟 友好型 了，无需切换。
   ```

### 测试5：不同性格的反馈风格

**测试场景**：测试4种性格的反馈差异

1. [ ] 友好型：温暖鼓励，多赞美
2. [ ] 专业型：理性分析，给建议
3. [ ] 严格型：直接指出问题，施加压力
4. [ ] 毒舌型：犀利吐槽，激将法

---

## 📝 性格切换命令格式

支持以下格式（都有效）：

```
切换性格：友好型
切换性格：专业型
切换性格：严格型
切换性格：毒舌型

切换：友好型
切换：专业型

性格：友好型
性格：专业型

# 也可以不带"型"字
切换性格：友好
切换性格：专业
```

---

## 🎯 性格解锁等级

| 性格 | 解锁等级 | 特点 | 适合人群 |
|------|---------|------|---------|
| 🌟 友好型 | LV1 | 温暖鼓励 | 新手，需要支持 |
| 💼 专业型 | LV4 | 理性分析 | 需要客观建议 |
| 🔥 严格型 | LV8 | 督导施压 | 需要压力督促 |
| 💀 毒舌型 | LV13 | 犀利吐槽 | 需要强烈刺激 |

---

## 🐛 问题排查

### 问题1：性格切换命令不识别
- [ ] 确认命令格式正确（参考上面的格式）
- [ ] 确认命令在邮件正文中（不是标题）
- [ ] 查看 Actions 日志，搜索 "性格切换"

### 问题2：切换失败（等级不足）
- [ ] 确认当前等级
- [ ] 查看性格解锁等级表
- [ ] 继续升级后再尝试

### 问题3：反馈风格没有变化
- [ ] 确认性格已经切换成功
- [ ] 在 Supabase 中查看 `user_gamification` 表的 `ai_personality` 字段
- [ ] 可能需要等下一次回复才能看到新风格

### 问题4：AI反馈不符合性格
- [ ] 这是AI生成的，可能有偏差
- [ ] 多测试几次，观察整体风格
- [ ] 如果持续不符合，可能需要调整提示词

---

## 📊 数据查看

### 查看当前性格
1. 登录 Supabase
2. 点击 **Table Editor**
3. 点击 `user_gamification` 表
4. 查看 `ai_personality` 字段：
   - `friendly` = 友好型
   - `professional` = 专业型
   - `strict` = 严格型
   - `toxic` = 毒舌型

### 查看可用性格
1. 点击 `level_config` 表
2. 查看 `unlocked_personalities` 字段
3. 根据当前等级查看可用性格

---

## ✅ 部署完成确认

当以下所有项都打勾时，说明 v3.2 部署成功：

- [ ] 代码推送到 GitHub 成功
- [ ] GitHub Actions 运行成功
- [ ] 每日复盘邮件显示性格切换提示
- [ ] 成功切换到专业型（LV4+）
- [ ] 切换后AI反馈风格改变
- [ ] 等级不足时显示错误提示
- [ ] 重复切换时显示提示

**🎉 恭喜！v3.2 AI性格系统部署成功！**

---

## 💡 使用建议

### 对用户的建议
1. **新手期（LV1-3）**：使用友好型，获得鼓励和支持
2. **成长期（LV4-7）**：尝试专业型，获得理性分析
3. **进阶期（LV8-12）**：使用严格型，接受督促和压力
4. **高级期（LV13+）**：尝试毒舌型，体验激将法

### 性格选择建议
- **拖延症严重**：严格型或毒舌型
- **缺乏动力**：友好型或专业型
- **需要分析**：专业型
- **需要刺激**：毒舌型

### 切换时机
- 感觉当前性格效果不好时
- 想尝试不同风格时
- 达到新等级解锁新性格时
- 心情或状态变化时

---

**版本**：v3.2  
**更新日期**：2026-02-10  
**状态**：AI性格系统已完成，等待测试  
**下一步**：测试通过后继续开发商店系统
